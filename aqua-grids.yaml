# This is the configuration file for the regridder.
# It is the part of the configuration that is machine independent.

# Templates
weights:
  template_default: weights_{model}_{exp}_{source}_{method}_{targetgrid}_l{level}.nc
  template_grid: weights_{sourcegrid}_{method}_{targetgrid}_l{level}.nc
areas:
  template_default: cell_area_{model}_{exp}_{source}.nc
  template_grid: cell_area_{grid}.nc
cdo-paths: # to be checked
  download: '{{ weights }}'
  icon: /pool/data/ICON

# Available grids
# extra is an extra special cdo command to be applied before generating the weights
grids:
  # default
  lon-lat:
    vert_coord: ["2d"]
    space_coord: [lon, lat]
  lon-lat-depth:
    vert_coord: ["depth"]
    space_coord: [lon, lat]

  # target regrid
  r005: r7200x3600
  r010: r3600x1800
  r020: r1800x900
  r025: r1440x720
  r050: r720x360
  r100: r360x180
  r200: r180x90
  r250: r144x72

  # Generic Healpix
  hpz5-nested:
    space_coord: ["ncells"]
    vert_coord: ["2d"]
    path: '{{ grids }}/HealPix/hpz5_nested_atm.nc'
  hpz7-nested:
    space_coord: ["ncells"]
    vert_coord: ["2d"]
    path: '{{ grids }}/HealPix/hpz7_nested_atm.nc'
  hpz9-nested:
    space_coord: ["ncells"]
    vert_coord: ["2d"]
    path: '{{ grids }}/HealPix/hpz9_nested_atm.nc'
  hpz10-nested:
    space_coord: ["ncells"]
    vert_coord: ["2d"]
    path: '{{ grids }}/HealPix/hpz10_nested_atm.nc'
  hpz7-ring:
    space_coord: ["ncells"]
    vert_coord: ["2d"]
    path: '{{ grids }}/HealPix/hpz7_ring_atm.nc'
  hpz10-ring:
    space_coord: ["ncells"]
    vert_coord: ["2d"]
    path: '{{ grids }}/HealPix/hpz10_ring_atm.nc'
  
  # NEMO oceanic Healpix: each ORCA grid needs its definition due to changing LSM
  nemo-eORCA1-hpz5-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/nemo-eORCA1_hpz5_nested_oce.nc'
  nemo-eORCA1-hpz5-nested-3d:
    path:
      level: '{{ grids }}/HealPix/nemo-eORCA1_hpz5_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  nemo-eORCA025-hpz7-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/nemo-eORCA025_hpz7_nested_oce.nc'
  nemo-eORCA025-hpz7-nested-3d:
    path:
      level: '{{ grids }}/HealPix/nemo-eORCA025_hpz7_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  nemo-eORCA12-hpz7-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/nemo-eORCA12_hpz7_nested_oce.nc'
  nemo-eORCA12-hpz7-nested-3d:
    path:
      level: '{{ grids }}/HealPix/nemo-eORCA12_hpz7_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  nemo-eORCA12-hpz10-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/nemo-eORCA12_hpz10_nested_oce.nc'
  nemo-eORCA12-hpz10-nested-3d:
    path:
      level: '{{ grids }}/HealPix/nemo-eORCA12_hpz10_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  
  # FESOM oceanic healpix
  fesom-hpz5-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/fesom_hpz5_nested_oce.nc'
  fesom-hpz5-nested-3d:
    path: 
      level: '{{ grids }}/HealPix/fesom_hpz5_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  fesom-hpz7-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/fesom_hpz7_nested_oce.nc'
  fesom-hpz7-nested-3d:
    path:
      level: '{{ grids }}/HealPix/fesom_hpz7_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  fesom-hpz9-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/fesom_hpz9_nested_oce.nc'
  fesom-hpz9-nested-3d:
    path:
      level: '{{ grids }}/HealPix/fesom_hpz9_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]

  # IFS-FESOM NG4 grids (after 2022-05-01)
  # Notice that these are different from those above due to different LS mask
  fesom-nextgems4-hpz7-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/fesom_nextgems4_hpz7_nested_oce.nc'
  fesom-nextgems4-hpz7-nested-3d:
    path:
      level: '{{ grids }}/HealPix/fesom_nextgems4_hpz7_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  fesom-nextgems4-hpz9-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/fesom_nextgems4_hpz9_nested_oce.nc'
  fesom-nextgems4-hpz9-nested-3d:
    path:
      level: '{{ grids }}/HealPix/fesom_nextgems4_hpz9_nested_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]

# ICON oceanic healpix
  icon-hpz10-nested:
    space_coord: ["ncells"]
    path: '{{ grids }}/HealPix/icon_hpz10_nested_oce.nc'
  icon-hpz10-nested-3d:
    path:
      level: '{{ grids }}/HealPix/icon_hpz10_nested_oce_level.nc'
  
  #IFS
  tl63:
    path: '{{ grids }}/IFS/tl63_grid.nc'
  tl159:
    path: '{{ grids }}/IFS/tl159_grid.nc'
  tco79:
    path:  
      2d: '{{ grids }}/IFS/tco79_grid.nc'
      2dm: '{{ grids }}/IFS/tco79_grid_masked.nc'
    vert_coord: ["2d", "2dm"]  # If the case is more complex than simply "2d" we need to specify this
    masked: 
      vars: ["ci", "sst"]
  tco399:
    path: 
      2d: '{{ grids }}/IFS/tco399_grid.nc'
      2dm: '{{ grids }}/IFS/tco399_grid_masked.nc'
    # space_coord: ["cell"] # levante
    # space_coord: ["ncells"] # lumi and mafalda
    vert_coord: ["2d", "2dm"]  # If the case is more complex than simply "2d" we need to specify this
    masked: 
      vars: ["ci", "sst"]
  tco1279:
    path: 
      2d: '{{ grids }}/IFS/tco1279_grid.nc'
      2dm: '{{ grids }}/IFS/tco1279_grid_masked.nc'
    masked: 
      vars: ["ci", "sst"]
    vert_coord: ["2d", "2dm"]
    # space_coord: ["value"] # levante
    # space_coord: ["ncells"] # lumi
  tco2559:
    path: 
      2d: '{{ grids }}/IFS/tco2559_grid.nc'
      2dm: '{{ grids }}/IFS/tco2559_grid_masked.nc'
    masked: 
      vars: ["ci", "sst"]
    vert_coord: ["2d", "2dm"]
    # space_coord: ["value"]
  tco3999: 
    path: '{{ grids }}/IFS/tco3999_grid.nc'
    # space_coord: ["value"]
  
  # IFS interpolated
  ifs-interpolated: 
    path: '{{ grids }}/IFS/ifs_interpolated5400x2700.nc'
    space_coord: ["lon", "lat"]
  multio-r025:
    space_coord: ["value"]
    vert_coord: ["2d"]
    extra: -setgrid,'{{ grids }}/IFS/grid_lonlat_025.txt
    cellareas: '{{ grids }}/IFS/cellarea_unstructured_025.nc'
    cellarea_var: cell_area
  ifs-healpix:
    space_coord: ["ncells"]
    vert_coord: ["2d"]
    path: '{{ grids }}/HealPix_old/ifs_hpx10.nc'

  #ICON
  R02B08:
    path: '{{ grids }}/ICON/icon_grid_0033_R02B08_G.nc'
    space_coord: ["cell"]
    extra: -selname,cell_index
  R02B09:
    path: '{{ grids }}/ICON/icon_grid_0015_R02B09_G.nc'
    space_coord: ["cell"]
    extra: -selname,cell_index
  # R02B09_oce:  #not working!!! wrong vert coordinates?
  #   path: '{{ grids }}/ICON/icon_grid_0015_R02B09_G.nc'
  #   space_coord: ["cell"]
  #   extra: -selname,cell_index
  #   vert_coord: ["depth_half", "depth_full"]
  icon-R02B09-intaketest: 
      path: '{{ grids }}/ICON/icon_grid_0015_R02B09_G.nc'
      extra: -selname,cell_index
      space_coord: ["ncells"]
  icon-healpix:
    path:
      2d: '{{ grids }}/HealPix_old/icon_hpx{zoom}_atm_2d.nc'   # this is the default 2d grid
      2dm: '{{ grids }}/HealPix_old/icon_hpx{zoom}_oce_2d.nc'  # this is an additional and optional 2d grid used if data are masked
      depth_full: '{{ grids }}/HealPix_old/icon_hpx{zoom}_oce_depth_full.nc'
      depth_half: '{{ grids }}/HealPix_old/icon_hpx{zoom}_oce_depth_half.nc'
    masked:   # This is the attribute used to distinguish variables which should go into the masked category
      component: ocean
    space_coord: ["cell"]
    vert_coord: ["depth_half", "depth_full"]
  
  #FESOM
  ng5-nodes-2d:
    path: '{{ grids }}/FESOM/AQUA_NG5_griddes_nodes_IFS.nc'
    space_coord: ["nod2"]
  ng5-nodes-3d:
    path:
      nz: '{{ grids }}/FESOM/NG5_nodes_fesom_mask_nz.nc'
      nz1: '{{ grids }}/FESOM/NG5_nodes_fesom_mask_nz1.nc'
    space_coord: ["nod2"]
    vert_coord: ["nz", "nz1"]
    extra: 
    - -setgrid,'{{ grids }}/FESOM/NG5_griddes_nodes_IFS.nc' 
  ng5-elems-2d:
    space_coord: ['elem']
    extra: 
    - -setgrid,'{{ grids }}/FESOM/NG5_griddes_elems_IFS.nc' 
  ng5-elems-3d:
    path:
      nz1: '{{ grids }}/FESOM/NG5_elem_fesom_mask_nz1.nc'
    space_coord: ["elem"]
    vert_coord: ["nz1"]
    extra: 
    - -setgrid,'{{ grids }}/FESOM/NG5_griddes_elems_IFS.nc'

  # FESOM interpolated
  fesom-interpolated-2d:
    path: '{{ grids }}/FESOM/fesom_tco2559_interpolated_2d.nc'
    space_coord: ["lon", "lat"]
  fesom-interpolated-3d:
    path: '{{ grids }}/FESOM/fesom_tco2559_interpolated_3d.nc'
    space_coord: ["lon", "lat"]
    vert_coord: depth

  # NEMO
  ORCA2-2d:
    path: '{{ grids }}/NEMO/ORCA2_mesh_sfc_grid_T.nc'
    space_coord: ["x", "y"]
  ORCA2-ece:
    path:
      2d: '{{ grids }}/NEMO/ORCA2_mesh_sfc_grid_T.nc'
      level: '{{ grids }}/NEMO/ORCA2_mesh_3d_grid_T_level.nc'
    space_coord: ["x", "y"]
    vert_coord: ["2d", "level"]
  eORCA1-ece:
    path: 
      2d: '{{ grids }}/NEMO/eORCA1_mesh_sfc_grid_T.nc'
      level: '{{ grids }}/NEMO/eORCA1_mesh_3d_grid_T_level.nc'
    space_coord: ["x", "y"]
    vert_coord: ["level"]
  eORCA1-2d:
    path: '{{ grids }}/NEMO/eORCA1_mesh_sfc_grid_T.nc'
  eORCA1-3d-level: 
    path: 
      level: '{{ grids }}/NEMO/eORCA1_mesh_3d_grid_T_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  eORCA1-3d-height: 
    path: 
      height: '{{ grids }}/NEMO/eORCA1_mesh_3d_grid_T_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["height"]
  eORCA025-2d:
    path: '{{ grids }}/NEMO/eORCA025_mesh_sfc_grid_T.nc'
  eORCA025-3d-level: 
    path: 
      level: '{{ grids }}/NEMO/eORCA025_mesh_3d_grid_T_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  eORCA025-3d-height: 
    path: 
      height: '{{ grids }}/NEMO/eORCA025_mesh_3d_grid_T_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["height"]
  eORCA12-2d:
    path: '{{ grids }}/NEMO/eORCA12_mesh_sfc_grid_T.nc'
  eORCA12-3d-level: 
    path: 
      level: '{{ grids }}/NEMO/eORCA12_mesh_3d_grid_T_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  eORCA12-3d-height: 
    path: 
      height: '{{ grids }}/NEMO/eORCA12_mesh_3d_grid_T_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["height"]
  nemo-healpix:
    path:
      2d: '{{ grids }}/HealPix_old/nemo_hpx10_oce_2d.nc' 
      level: '{{ grids }}/HealPix_old/nemo_hpx10_oce_level.nc'
    space_coord: ["ncells"]
    vert_coord: ["level"]
  nemo-multiIO-r025:
    path: '{{ grids }}/lonlat/nemo-multiIO-r025.nc'
  nemo-multiIO-r025-3d:
    path:
      level: '{{ grids }}/lonlat/nemo-multiIO-r025-3d.nc'

  # OBSERVATIONS

  # AVISO
  aviso:
    space_coord: ["longitude", "latitude"]

  # EN4
  en4:
    path:
      lev: '{{ grids }}/EN4/en4-grid.nc'
    space_coord: ["lon", "lat"]
    vert_coord: ["lev"]

  # ERA5
  era5-n320:
    path: '{{ grids }}/ERA5/n320_unstructured.nc'
    space_coord: ["values"]
  era5-r025:
    path: 
      2d: '{{ grids }}/ERA5/r025_grid.nc'
      2dm: '{{ grids }}/ERA5/r025_grid_masked.nc'
    masked: 
      vars: ["SSTK", "sst", "avg_tos"]
    space_coord: ["lon", "lat"]
    vert_coord: ["2d", "2dm"]

  # OSI-SAF
  osi-saf-nh:
    path: '{{ grids }}/OSI-SAF/grid_osi-saf_nh.nc'
    space_coord: ['xc', 'yc']
    cellareas: '{{ grids }}/OSI-SAF/cellarea_osi-saf_nh.nc'
    cellarea_var: areacello
    regrid_method: 'bil'

  osi-saf-sh:
    path: '{{ grids }}/OSI-SAF/grid_osi-saf_sh.nc'
    space_coord: ['xc', 'yc']
    cellareas: '{{ grids }}/OSI-SAF/cellarea_osi-saf_sh.nc'
    cellarea_var: areacello
    regrid_method: 'bil'

  # WOA
  woa:
    path:
      depth: '{{ grids }}/WOA18/grid-woa18.nc'
    vert_coord: depth
    space_coord: ["lon", "lat"]

  # PSC
  psc-piomas:
    space_coord: ["x", "y"]
    cellareas: '{{ grids }}/PSC/cellarea_piomas.nc'
    cellarea_var: areacello
    path: '{{ grids }}/PSC/grid_piomas_new.nc'
    regrid_method: 'bil'
  psc-giomas:
    space_coord: ["x", "y"]
    cellareas: '{{ grids }}/PSC/cellarea_giomas.nc'
    cellarea_var: areacello
    path: '{{ grids }}/PSC/grid_giomas_new.nc'
    regrid_method: 'bil'
    